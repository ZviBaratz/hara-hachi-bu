{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Hara Hachi Bu","text":"<p>\u8179\u516b\u5206\u76ee</p> Hara Hachi Bu <p>     Unified Quick Settings control for power profiles and battery charging on GNOME Shell.   </p> Get Started Quick Start \u2192 <p>A GNOME Shell extension for ThinkPad, Framework, ASUS, and any laptop with standard Linux battery controls. One menu to manage everything: power profiles, charging thresholds, named profiles, auto-switch rules, and scheduled charging windows.</p> <p>Why \"Hara Hachi Bu\"? \u8179\u516b\u5206\u76ee is an Okinawan practice of eating until you're 80% full \u2014 a philosophy of intentional restraint that promotes longevity. This extension applies the same principle to your laptop battery: stop charging before 100% to extend its lifespan.</p>"},{"location":"#what-it-does","title":"What It Does","text":"<p>Hara Hachi Bu adds a unified section to your GNOME Quick Settings panel where you can:</p> <ul> <li>Switch power profiles \u2014 Performance, Balanced, Power Saver</li> <li>Control battery charging \u2014 limit charge to 60%, 80%, or 100%</li> <li>Activate scenarios \u2014 named combinations like Docked or Travel</li> <li>Automate everything \u2014 rules based on display, power source, lid, or battery level</li> <li>Schedule profiles \u2014 charge to full on weekday mornings, revert automatically</li> <li>Boost charge \u2014 one-click to 100% with automatic revert</li> </ul>"},{"location":"#key-features","title":"Key Features","text":"Feature Description Power Profiles Performance / Balanced / Power Saver via <code>power-profiles-daemon</code> Battery Modes Full Capacity (95\u2013100%), Balanced (75\u201380%), Max Lifespan (55\u201360%) Custom Scenarios Named combinations of power + battery mode + optional force discharge Rule-Based Auto-Switch External display, power source, lid state, battery level Scheduled Profiles Per-day + time range, overnight support, DST-safe Boost Charge AC-only, auto-reverts on full battery / timeout / AC disconnect Battery Health Color-coded maximum capacity display Force Discharge ThinkPad and compatible hardware Multi-Battery BAT0 through BAT3 supported"},{"location":"#quick-install","title":"Quick Install","text":"<pre><code># 1. Install from extensions.gnome.org (search \"Hara Hachi Bu\")\n# 2. Then install the required helper script:\ncd ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz\nsudo ./install-helper.sh\n</code></pre> <p>See Installation for full details \u2014 manual install, polkit setup, and uninstallation.</p>"},{"location":"#where-to-go-next","title":"Where to Go Next","text":"Goal Page New user, first time setup Quick Start Understand battery modes and the science Battery Modes Set up Docked / Travel scenarios Scenarios Auto-switch based on display or power source Auto-Switch Rules Schedule charging windows Scheduled Profiles Configure thresholds and preferences Preferences Check if your hardware is supported Hardware Compatibility"},{"location":"#compatibility","title":"Compatibility","text":"<ul> <li>GNOME Shell: 46, 47, 48, 49</li> <li>Hardware: Any laptop exposing <code>charge_control_end_threshold</code> in <code>/sys/class/power_supply/</code></li> <li>Power Profiles: Requires <code>power-profiles-daemon</code></li> </ul>"},{"location":"contributing/","title":"Contributing","text":"<p>Thank you for your interest in contributing! This guide covers development setup, conventions, and the pull request process.</p>"},{"location":"contributing/#quick-start","title":"Quick Start","text":"<p>Prerequisites:</p> <ul> <li>GNOME Shell 46, 47, 48, or 49</li> <li><code>glib-compile-schemas</code> (from <code>libglib2.0-dev</code> or equivalent)</li> <li><code>power-profiles-daemon</code> (for power profile features)</li> </ul> <p>Note</p> <p>If you already have the extension installed from extensions.gnome.org, disable and remove it first to avoid conflicts: <code>gnome-extensions disable hara-hachi-bu@ZviBaratz</code></p> <pre><code># Clone the repository\ngit clone https://github.com/ZviBaratz/hara-hachi-bu.git \\\n    ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz\n\n# Compile schemas\ncd ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz\nmake schemas\n</code></pre>"},{"location":"contributing/#mock-mode","title":"Mock Mode","text":"<p>Test the extension without battery hardware by enabling mock mode:</p> <pre><code>mkdir -p ~/.config/hara-hachi-bu\ntouch ~/.config/hara-hachi-bu/use_mock\n</code></pre> <p>This activates an in-memory device backend that simulates threshold and force-discharge controls. Remove the file to return to real hardware.</p>"},{"location":"contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"contributing/#makefile-targets","title":"Makefile Targets","text":"Target Description <code>make dev</code> Compile schemas and start a nested GNOME Shell session <code>make nested</code> Start a nested GNOME Shell session only <code>make schemas</code> Compile GSettings schemas <code>make install</code> Install extension to <code>~/.local/share/gnome-shell/extensions/</code> <code>make pack</code> Create release zip via <code>package.sh</code> <code>make logs</code> Follow GNOME Shell logs (<code>journalctl</code>) <code>make clean</code> Remove temporary/build files"},{"location":"contributing/#testing-on-x11-vs-wayland","title":"Testing on X11 vs Wayland","text":"<ul> <li>X11: Reload the extension with Alt+F2 \u2192 <code>r</code> \u2192 Enter.</li> <li>Wayland: JavaScript changes require a full logout and login. Disabling/enabling the extension alone does not reload code.</li> </ul>"},{"location":"contributing/#viewing-logs","title":"Viewing Logs","text":"<pre><code># Follow all GNOME Shell logs\nmake logs\n\n# Filter for extension output\njournalctl -o cat /usr/bin/gnome-shell --since \"5 minutes ago\" | grep -i hara-hachi-bu\n</code></pre>"},{"location":"contributing/#helper-script","title":"Helper Script","text":"<p>Battery threshold control requires a privileged helper script. To test threshold features:</p> <pre><code>sudo ./install-helper.sh\n</code></pre>"},{"location":"contributing/#commit-convention","title":"Commit Convention","text":"<p>This project uses Conventional Commits.</p>"},{"location":"contributing/#format","title":"Format","text":"<pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;\n\n[optional body]\n\n[optional footer(s)]\n</code></pre>"},{"location":"contributing/#types","title":"Types","text":"Type Description <code>feat</code> New feature or user-facing functionality <code>fix</code> Bug fix <code>refactor</code> Code change that neither fixes a bug nor adds a feature <code>perf</code> Performance improvement <code>style</code> Formatting, whitespace, missing semicolons (no logic change) <code>docs</code> Documentation only <code>chore</code> Build process, packaging, dependencies, tooling <code>ci</code> CI/CD changes <code>test</code> Adding or updating tests"},{"location":"contributing/#scopes","title":"Scopes","text":"Scope Component <code>prefs</code> Preferences UI (<code>prefs.js</code>) <code>panel</code> Quick Settings panel (<code>quickSettingsPanel.js</code>) <code>state</code> StateManager <code>power</code> PowerProfileController <code>battery</code> BatteryThresholdController <code>device</code> Device backends <code>profiles</code> ProfileMatcher, profile management <code>rules</code> RuleEvaluator, ParameterDetector <code>helper</code> Helper script and utilities <code>schema</code> GSettings schema <code>i18n</code> Translations and internationalization"},{"location":"contributing/#examples","title":"Examples","text":"<pre><code>feat(panel): add battery health percentage to status display\nfix(battery): correct threshold write ordering for end-only devices\nrefactor(state): extract profile validation into separate method\nchore: update metadata for GNOME 47 compatibility\ndocs: document multi-battery support in README\n</code></pre>"},{"location":"contributing/#breaking-changes","title":"Breaking Changes","text":"<p>Append <code>!</code> after the type/scope and include a <code>BREAKING CHANGE:</code> footer:</p> <pre><code>feat(schema)!: remove legacy profile settings\n\nBREAKING CHANGE: Removed profile-docked and profile-travel settings.\nProfiles are now stored exclusively in custom-profiles JSON format.\n</code></pre>"},{"location":"contributing/#architecture-overview","title":"Architecture Overview","text":"<p>The extension follows a Controllers \u2192 StateManager \u2192 UI signal flow:</p> <ol> <li>Hardware controllers (<code>PowerProfileController</code>, <code>BatteryThresholdController</code>) detect changes and emit signals</li> <li><code>StateManager</code> aggregates these into a unified <code>state-changed</code> signal</li> <li>The Quick Settings panel subscribes to <code>StateManager</code> for UI updates</li> </ol> <p>See Hardware Compatibility for device backend information.</p>"},{"location":"contributing/#key-code-patterns","title":"Key Code Patterns","text":"<ul> <li>Async <code>_destroyed</code> flag: Controllers set <code>this._destroyed = true</code> at the start of <code>destroy()</code>. All async callbacks and promise chains check this flag before accessing object state.</li> <li>Resource cleanup in <code>destroy()</code>: Timeouts, signal connections, file monitors, and D-Bus proxies must all be cleaned up.</li> <li>Threshold write ordering: When changing battery thresholds, start and end values must be written in the correct order to avoid kernel errors. See <code>GenericSysfsDevice.setThresholds()</code>.</li> </ul>"},{"location":"contributing/#translations","title":"Translations","text":"<p>The extension uses GNU gettext for internationalization.</p>"},{"location":"contributing/#adding-a-new-language","title":"Adding a New Language","text":"<pre><code>mkdir -p po\ncp hara-hachi-bu.pot po/&lt;LANG&gt;.po\n# e.g., po/de.po for German, po/fr.po for French\n</code></pre> <p>Edit the <code>.po</code> file with a translation editor (Poedit, GNOME Translation Editor, or any text editor) and submit a pull request.</p>"},{"location":"contributing/#updating-the-template","title":"Updating the Template","text":"<p>After adding or changing translatable strings:</p> <pre><code>make pot\n</code></pre> <p>Commit the updated <code>.pot</code> alongside your code changes.</p>"},{"location":"contributing/#pull-request-guidelines","title":"Pull Request Guidelines","text":"<ol> <li>One logical change per PR \u2014 separate unrelated fixes into different PRs</li> <li>Follow the commit convention described above</li> <li>Test on real hardware or mock mode \u2014 mention which you used in the PR description</li> <li>Compile schemas if you changed the GSettings schema (<code>make schemas</code>)</li> <li>Check logs for warnings or errors after your changes (<code>make logs</code>)</li> </ol> <p>Issues and pull requests welcome at github.com/ZviBaratz/hara-hachi-bu.</p>"},{"location":"contributing/#license","title":"License","text":"<p>By contributing, you agree that your contributions will be licensed under the GPL-3.0-or-later license.</p>"},{"location":"installation/","title":"Installation","text":""},{"location":"installation/#from-extensionsgnomeorg","title":"From extensions.gnome.org","text":"<p>Search for \"Hara Hachi Bu\" on extensions.gnome.org and click Install.</p> <p>Important</p> <p>After installing the extension, you must also install the helper script to enable battery threshold control. See Helper Script Installation below.</p>"},{"location":"installation/#manual-installation","title":"Manual Installation","text":"<pre><code># Clone to the extensions directory\ngit clone https://github.com/ZviBaratz/hara-hachi-bu.git \\\n    ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz\n\n# Compile GSettings schemas\nglib-compile-schemas \\\n    ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz/schemas/\n\n# Enable the extension\ngnome-extensions enable hara-hachi-bu@ZviBaratz\n</code></pre> <p>Then log out and log back in (Wayland), or restart GNOME Shell with Alt+F2 \u2192 type <code>r</code> \u2192 Enter (X11 only).</p>"},{"location":"installation/#helper-script-installation","title":"Helper Script Installation","text":"<p>Battery threshold control requires root privileges. GNOME extensions cannot install system files automatically, so you need to run a one-time setup script.</p>"},{"location":"installation/#automated-recommended","title":"Automated (recommended)","text":"<pre><code>cd ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz\nsudo ./install-helper.sh\n</code></pre> <p>The script copies <code>hhb-power-ctl</code> to <code>/usr/local/bin/</code> and installs the appropriate polkit rules for your system.</p>"},{"location":"installation/#manual","title":"Manual","text":"<pre><code># Install the helper script\nsudo cp resources/hhb-power-ctl /usr/local/bin/\nsudo chmod +x /usr/local/bin/hhb-power-ctl\n\n# Install polkit rules (modern polkit &gt;= 0.106)\nsudo cp resources/10-hara-hachi-bu.rules /etc/polkit-1/rules.d/\n\n# OR for legacy polkit (&lt; 0.106)\nsudo cp resources/org.gnome.shell.extensions.hara-hachi-bu.policy \\\n    /usr/share/polkit-1/actions/\n</code></pre>"},{"location":"installation/#verify-installation","title":"Verify Installation","text":"<p>After installing, open the extension's Preferences \u2192 About tab to confirm the helper status shows as installed and polkit is configured.</p> <p>You can also test manually:</p> <pre><code>pkexec hhb-power-ctl BAT0_END_START 60 55\n</code></pre>"},{"location":"installation/#uninstallation","title":"Uninstallation","text":"<p>To remove the helper script and polkit rules:</p> <pre><code>cd ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz\nsudo ./install-helper.sh --uninstall\n</code></pre> <p>To remove the extension itself, disable it and delete the directory:</p> <pre><code>gnome-extensions disable hara-hachi-bu@ZviBaratz\nrm -rf ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz\n</code></pre>"},{"location":"preferences/","title":"Preferences","text":"<p>Open the preferences window:</p> <pre><code>gnome-extensions prefs hara-hachi-bu@ZviBaratz\n</code></pre> <p>Or find it in GNOME Extensions app \u2192 Hara Hachi Bu \u2192 Settings.</p> <p></p>"},{"location":"preferences/#general","title":"General","text":""},{"location":"preferences/#user-interface","title":"User Interface","text":"<ul> <li>Show system indicator \u2014 toggle the extension's panel indicator visibility</li> <li>Show force discharge toggle \u2014 show/hide the force discharge option in Quick Settings</li> <li>Hide built-in power profile indicator \u2014 remove GNOME's default power profile indicator from the panel (reduces clutter since this extension replaces its functionality)</li> <li>Battery health display \u2014 show maximum capacity as a color-coded percentage; configure the thresholds for Good/Fair/Poor ratings</li> </ul>"},{"location":"preferences/#battery-management","title":"Battery Management","text":"<ul> <li>Automatic discharge to threshold \u2014 when the battery is above the current threshold on AC, enable force discharge to bring it down (ThinkPad and compatible hardware only)</li> <li>Boost charge timeout \u2014 safety timeout for boost charge (1\u201312 hours, default 2 hours). The primary stop trigger is the battery reaching 100%; this is a fallback.</li> </ul>"},{"location":"preferences/#automatic-scenario-switching","title":"Automatic Scenario Switching","text":"<ul> <li>Enable auto-switching \u2014 turn on/off rule-based automatic profile activation</li> <li>Resume on state change \u2014 when auto-management is paused (after a manual override), automatically resume when a parameter changes (display, power source, lid)</li> </ul>"},{"location":"preferences/#thresholds","title":"Thresholds","text":"<p>Configure the charging percentage range for each battery mode.</p> <p>On devices with both start and end threshold support (ThinkPad, Framework), you set both the start (when charging begins) and end (maximum charge) values.</p> <p>On devices with only end threshold support (some ASUS models), only the maximum charge is configurable.</p> <p>Default ranges:</p> Mode Start End Full Capacity 95% 100% Balanced 75% 80% Max Lifespan 55% 60% <p>Tip</p> <p>The start threshold should always be at least 5% below the end threshold. If you set them too close together, the battery won't start charging until it drops very low.</p>"},{"location":"preferences/#scenarios","title":"Scenarios","text":"<p>Create, edit, and delete profiles (scenarios). Each scenario combines:</p> <ul> <li>A name and icon</li> <li>Power mode and battery mode</li> <li>Optional force discharge setting</li> <li>Optional auto-switch rules</li> <li>Optional schedule</li> </ul> <p>Built-in scenarios (Docked, Travel) can be customized or deleted. If you delete all built-in scenarios, a Restore Default Scenarios button appears.</p>"},{"location":"preferences/#export-and-import","title":"Export and Import","text":"<p>Use the Export and Import buttons at the top of the Scenarios page to save your profiles to a JSON file or load them from one. Useful for syncing configuration between machines.</p>"},{"location":"preferences/#about","title":"About","text":"<p>Displays:</p> <ul> <li>Extension version</li> <li>Helper script installation status and path</li> <li>Polkit configuration status</li> <li>Detected battery hardware (battery name, capacity, sysfs capabilities)</li> </ul> <p>Use this tab to verify the extension is correctly set up on your system.</p>"},{"location":"quick-start/","title":"Quick Start","text":"<p>Get up and running in five minutes.</p>"},{"location":"quick-start/#step-1-install-the-extension","title":"Step 1: Install the Extension","text":"<p>Option A \u2014 extensions.gnome.org (recommended)</p> <p>Search for \"Hara Hachi Bu\" on extensions.gnome.org and click Install.</p> <p>Option B \u2014 Manual</p> <pre><code>git clone https://github.com/ZviBaratz/hara-hachi-bu.git \\\n    ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz\nglib-compile-schemas \\\n    ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz/schemas/\ngnome-extensions enable hara-hachi-bu@ZviBaratz\n</code></pre> <p>Log out and log back in to activate the extension (required on Wayland).</p>"},{"location":"quick-start/#step-2-install-the-helper-script","title":"Step 2: Install the Helper Script","text":"<p>Battery threshold control requires a privileged helper. Run this once:</p> <pre><code>cd ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz\nsudo ./install-helper.sh\n</code></pre> <p>Note</p> <p>Without the helper script, you can still use power profiles \u2014 but battery threshold control (the core feature) will not work.</p>"},{"location":"quick-start/#step-3-open-quick-settings","title":"Step 3: Open Quick Settings","text":"<p>Click the system tray area in the top-right corner of your screen to open Quick Settings. You should see a new section with:</p> <ul> <li>A row of profile buttons (Docked, Travel, and any custom profiles)</li> <li>Power mode selector (Performance / Balanced / Power Saver)</li> <li>Battery mode selector (Full Capacity / Balanced / Max Lifespan)</li> <li>Battery health and status information</li> </ul> <p></p>"},{"location":"quick-start/#step-4-try-a-profile","title":"Step 4: Try a Profile","text":"<p>If you're at a desk with an external display connected, click Docked. The extension will:</p> <ol> <li>Switch to Performance power mode</li> <li>Set battery charging to Max Lifespan (55\u201360%)</li> <li>Enable force discharge if your hardware supports it</li> </ol> <p>Going on a trip? Click Travel to switch to Balanced power mode and Full Capacity charging (up to 100%).</p> <p>Tip</p> <p>The Docked and Travel profiles have built-in auto-switch rules. If auto-management is enabled, the extension activates the right profile automatically based on whether an external display is connected and whether you're on AC power.</p>"},{"location":"quick-start/#step-5-configure-your-thresholds","title":"Step 5: Configure Your Thresholds","text":"<p>Open Preferences to customize the charging percentages for each mode:</p> <pre><code>gnome-extensions prefs hara-hachi-bu@ZviBaratz\n</code></pre> <p>In the Thresholds tab, you'll see sliders (or spinners) for each battery mode:</p> Mode Default Range What to adjust Full Capacity 95\u2013100% Raise start if you want a wider window Balanced 75\u201380% Good default for most users Max Lifespan 55\u201360% Lower end if you're always at a desk"},{"location":"quick-start/#whats-next","title":"What's Next?","text":"<ul> <li>Custom profiles \u2014 Create your own in Preferences \u2192 Scenarios. See Profiles.</li> <li>Auto-switching \u2014 Set rules so profiles activate automatically. See Auto-Switch Rules.</li> <li>Scheduled charging \u2014 Charge to full only on weekday mornings. See Scheduled Profiles.</li> <li>Boost charge \u2014 Need 100% for a one-off trip? See Profiles.</li> </ul>"},{"location":"security/","title":"Security","text":""},{"location":"security/#security-model","title":"Security Model","text":"<p>Hara Hachi Bu implements a layered security architecture to safely provide privileged battery threshold control from a GNOME Shell extension.</p>"},{"location":"security/#architecture","title":"Architecture","text":"<ul> <li>Extension code: JavaScript runs unprivileged in the GNOME Shell process. All device queries and display operations occur without elevation.</li> <li>Privileged operations: Battery threshold writes to <code>/sys/class/power_supply/</code> require privilege escalation via polkit (pkexec).</li> <li>Helper script: <code>hhb-power-ctl</code> runs as root through the polkit authorization system and implements strict validation before writing to sysfs.</li> </ul>"},{"location":"security/#input-validation-4-layer-defense","title":"Input Validation (4-Layer Defense)","text":"<p>The helper script implements defense-in-depth validation to prevent injection and path traversal attacks:</p> <p>1. Input Sanitization</p> <p>All inputs are validated against the regex <code>[a-zA-Z0-9_-]</code> (alphanumeric, underscore, hyphen). Any invalid character is rejected immediately.</p> <p>2. Filename Whitelist</p> <p>Only three sysfs filenames are allowed:</p> <ul> <li><code>charge_control_start_threshold</code></li> <li><code>charge_control_end_threshold</code></li> <li><code>charge_behaviour</code></li> </ul> <p>This prevents writing to other sysfs files or unintended battery attributes.</p> <p>3. Path Canonicalization</p> <p>The resolved path is computed using <code>realpath -e</code>, which:</p> <ul> <li>Resolves all symbolic links</li> <li>Verifies the file exists</li> <li>Returns the absolute canonical path</li> <li>Fails if the path does not exist (protecting against TOCTOU attacks)</li> </ul> <p>4. Prefix Validation</p> <p>The canonical path is verified to begin with <code>/sys/</code> before writing. This prevents the helper from writing to other parts of the filesystem.</p>"},{"location":"security/#polkit-authorization","title":"Polkit Authorization","text":"<p>The polkit rules (<code>10-hara-hachi-bu.rules</code>) enforce:</p> <ul> <li>User must be in the <code>sudo</code> or <code>wheel</code> group</li> <li>Session must be active (not locked or suspended)</li> <li>Authentication occurs in the user's local session only</li> </ul> <p>This is intentional for UX \u2014 constantly prompting for a password when changing power modes would be disruptive. The trade-off is that any process running as your user in an active local session can change battery thresholds.</p> <p>Remote and inactive sessions require admin authentication (or are blocked entirely on legacy polkit).</p>"},{"location":"security/#reporting-a-vulnerability","title":"Reporting a Vulnerability","text":"<p>Do not open a public GitHub issue for security vulnerabilities. Instead, report privately using GitHub Security Advisories.</p>"},{"location":"security/#how-to-report","title":"How to Report","text":"<ol> <li>Visit: github.com/ZviBaratz/hara-hachi-bu/security/advisories/new</li> <li>Provide:</li> <li>Description: Clear explanation of the issue</li> <li>Reproduction steps: Steps to reproduce the vulnerability</li> <li>Affected versions: Which extension versions are impacted</li> <li>Potential impact: What an attacker could accomplish</li> <li>Suggested fix (optional): If you have a mitigation in mind</li> </ol>"},{"location":"security/#response-timeline","title":"Response Timeline","text":"<p>You can expect a response within 7 days of submission. The maintainers will acknowledge receipt, confirm or dispute the vulnerability, discuss a patching timeline, and coordinate public disclosure.</p>"},{"location":"security/#scope","title":"Scope","text":""},{"location":"security/#in-scope","title":"In Scope","text":"<ul> <li>Helper Script Validation Bypass: Circumventing input sanitization, filename whitelisting, or path canonicalization</li> <li>Sysfs Path Traversal: Exploiting symlink resolution or canonicalization logic to write outside <code>/sys/</code></li> <li>Pkexec Command Injection: Injecting shell metacharacters or crafted arguments to pkexec</li> <li>Polkit Policy Weaknesses: Issues with group membership validation or session state checks</li> <li>Extension-to-Helper Communication: Vulnerabilities in how the extension invokes the helper</li> </ul>"},{"location":"security/#out-of-scope","title":"Out of Scope","text":"<ul> <li>Attacks Requiring Root Access: Issues that only manifest if the attacker already has root privileges</li> <li>Physical Access Attacks: Attacks requiring physical access to the computer or filesystem</li> <li>Denial of Service via UI: Repeatedly invoking pkexec dialogs (a user friction issue, not a security vulnerability)</li> <li>Upstream Vulnerabilities: Issues in <code>power-profiles-daemon</code>, UPower, GNOME Shell, or polkit \u2014 report these to those projects</li> </ul>"},{"location":"security/#supported-versions","title":"Supported Versions","text":"<p>Currently, version 1.x receives security updates. Users should always upgrade to the newest version to receive security fixes.</p>"},{"location":"hardware/compatibility/","title":"Hardware Compatibility","text":""},{"location":"hardware/compatibility/#overview","title":"Overview","text":"<p>Hara Hachi Bu works with any laptop that exposes battery charge control via the standard Linux sysfs interface. No vendor-specific drivers or kernel patches required.</p>"},{"location":"hardware/compatibility/#minimum-requirements","title":"Minimum Requirements","text":"Feature Requirement Battery threshold control <code>charge_control_end_threshold</code> in <code>/sys/class/power_supply/BAT*/</code> Full threshold control (start + end) Also requires <code>charge_control_start_threshold</code> Force discharge <code>charge_behaviour</code> in <code>/sys/class/power_supply/BAT*/</code> Power profiles <code>power-profiles-daemon</code> installed and running"},{"location":"hardware/compatibility/#device-detection","title":"Device Detection","text":"<p>The extension automatically enumerates batteries in <code>/sys/class/power_supply/</code>. If enumeration fails, it falls back to checking BAT0, BAT1, BAT2, BAT3 in order. The first battery with <code>charge_control_end_threshold</code> is used as the primary control device.</p> <p>Multi-battery systems (BAT0 through BAT3) are fully supported with synchronized thresholds.</p>"},{"location":"hardware/compatibility/#known-compatible-hardware","title":"Known Compatible Hardware","text":""},{"location":"hardware/compatibility/#full-support-start-end-threshold","title":"Full Support (start + end threshold)","text":"<ul> <li>ThinkPad \u2014 via <code>thinkpad_acpi</code> kernel module (all modern models)</li> <li>Framework \u2014 via standard kernel interfaces</li> <li>Some Dell models \u2014 depends on kernel version and model</li> </ul>"},{"location":"hardware/compatibility/#end-only-support","title":"End-Only Support","text":"<ul> <li>ASUS \u2014 many models expose only <code>charge_control_end_threshold</code>; end-only devices are fully supported including battery mode auto-detection based on the end threshold value</li> </ul> <p>Note</p> <p>End-only devices display a simplified view in Preferences \u2192 Thresholds (no start threshold slider).</p>"},{"location":"hardware/compatibility/#checking-your-hardware","title":"Checking Your Hardware","text":"<pre><code># Check for threshold support\nls /sys/class/power_supply/BAT0/charge_control_*\n\n# Typical output on ThinkPad / Framework:\n# /sys/class/power_supply/BAT0/charge_control_end_threshold\n# /sys/class/power_supply/BAT0/charge_control_start_threshold\n\n# ASUS (end-only):\n# /sys/class/power_supply/BAT0/charge_control_end_threshold\n\n# Check force discharge support\nls /sys/class/power_supply/BAT0/charge_behaviour\n</code></pre>"},{"location":"hardware/compatibility/#ac-adapter-detection","title":"AC Adapter Detection","text":"<p>The extension automatically detects the AC adapter by checking these known names in order: <code>AC</code>, <code>ACAD</code>, <code>ADP0</code>, <code>ADP1</code>. The first available adapter is used for power source detection.</p>"},{"location":"hardware/compatibility/#power-profiles","title":"Power Profiles","text":"<p>Power profile switching requires <code>power-profiles-daemon</code>. Check if it's installed and running:</p> <pre><code>systemctl status power-profiles-daemon\npowerprofilesctl list\n</code></pre> <p>If not installed:</p> <pre><code># Debian/Ubuntu\nsudo apt install power-profiles-daemon\n\n# Fedora\nsudo dnf install power-profiles-daemon\n</code></pre>"},{"location":"hardware/compatibility/#adding-support-for-new-hardware","title":"Adding Support for New Hardware","text":"<p>The extension uses a modular device backend architecture. If your device uses a completely different mechanism (not standard sysfs paths), you can add a new backend.</p>"},{"location":"hardware/compatibility/#when-you-dont-need-a-new-backend","title":"When You Don't Need a New Backend","text":"<p>If your device exposes <code>/sys/class/power_supply/BAT0/charge_control_end_threshold</code>, it is already supported by the built-in <code>GenericSysfsDevice</code> implementation.</p>"},{"location":"hardware/compatibility/#creating-a-new-backend","title":"Creating a New Backend","text":"<ol> <li>Create a new file in <code>lib/device/</code> (e.g., <code>MyLaptopDevice.js</code>)</li> <li>Inherit from <code>BaseDevice</code> and implement the required methods:</li> </ol> <pre><code>import { BaseDevice } from './BaseDevice.js';\n\nexport const MyLaptopDevice = GObject.registerClass({\n    GTypeName: 'HHBMyLaptopDevice',\n}, class MyLaptopDevice extends BaseDevice {\n    async initialize() {\n        // Check for specific files or DMI strings\n        // Return true if compatible\n    }\n\n    static isSupported() {\n        // Synchronous check \u2014 return true if this is a MyLaptop\n        return false;\n    }\n\n    async setThresholds(start, end) {\n        // Write to sysfs\n        // Use hhb-power-ctl if root permissions are required\n    }\n});\n</code></pre> <ol> <li>Register your device in <code>lib/device/DeviceManager.js</code> before the <code>GenericSysfsDevice</code> catch-all.</li> </ol>"},{"location":"hardware/compatibility/#extending-the-helper-script","title":"Extending the Helper Script","text":"<p>If root privileges are needed, extend <code>resources/hhb-power-ctl</code>:</p> <ol> <li>Add a new command case for your hardware</li> <li>Security note: Hardcode the sysfs paths in the script \u2014 do not pass arbitrary paths as arguments</li> </ol> <p>See Contributing for how to submit the new backend.</p>"},{"location":"hardware/compatibility/#mock-mode-testing-without-hardware","title":"Mock Mode (Testing Without Hardware)","text":"<p>To test the UI without real battery hardware:</p> <pre><code>mkdir -p ~/.config/hara-hachi-bu\ntouch ~/.config/hara-hachi-bu/use_mock\n</code></pre> <p>Reload the extension. All threshold changes will be simulated in-memory and logged to the journal. Remove the file to return to real hardware.</p>"},{"location":"hardware/troubleshooting/","title":"Troubleshooting","text":""},{"location":"hardware/troubleshooting/#extension-doesnt-load","title":"Extension Doesn't Load","text":"<p>Check for errors in the GNOME Shell journal:</p> <pre><code>journalctl -f -o cat /usr/bin/gnome-shell\n</code></pre> <p>Filter for extension-specific messages:</p> <pre><code>journalctl -o cat /usr/bin/gnome-shell --since \"5 minutes ago\" | grep -i hara-hachi-bu\n</code></pre> <p>Common causes:</p> <ul> <li>Schema not compiled \u2014 run <code>glib-compile-schemas ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz/schemas/</code></li> <li>GNOME Shell version mismatch \u2014 check <code>metadata.json</code> for supported versions</li> <li>JavaScript error \u2014 the log will show the exact line</li> </ul>"},{"location":"hardware/troubleshooting/#battery-thresholds-not-changing","title":"Battery Thresholds Not Changing","text":"<p>Work through these checks in order:</p> <p>1. Verify the helper is installed</p> <pre><code>which hhb-power-ctl\n</code></pre> <p>If not found, run the installer:</p> <pre><code>cd ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz\nsudo ./install-helper.sh\n</code></pre> <p>2. Check polkit rules</p> <pre><code>ls /etc/polkit-1/rules.d/10-hara-hachi-bu.rules\n</code></pre> <p>If missing, reinstall the helper script. See Installation.</p> <p>3. Test the helper manually</p> <pre><code>pkexec hhb-power-ctl BAT0_END_START 60 55\n</code></pre> <p>For BAT1: use <code>BAT1_END_START</code>. If this fails, check the error message \u2014 it will indicate whether the issue is permissions, the sysfs path, or the helper script itself.</p> <p>4. Check hardware support</p> <pre><code>ls /sys/class/power_supply/BAT0/charge_control_*\n</code></pre> <p>If no files are shown, your laptop's kernel driver does not expose battery threshold control. See Hardware Compatibility.</p>"},{"location":"hardware/troubleshooting/#preferences-about-shows-helper-not-found","title":"Preferences \u2192 About Shows \"Helper Not Found\"","text":"<p>The helper script is not installed or not in PATH. Install it:</p> <pre><code>cd ~/.local/share/gnome-shell/extensions/hara-hachi-bu@ZviBaratz\nsudo ./install-helper.sh\n</code></pre> <p>If the installer reports a polkit warning, your system may use a non-standard polkit location. Check the install output for details.</p>"},{"location":"hardware/troubleshooting/#power-profiles-not-working","title":"Power Profiles Not Working","text":"<p>1. Check if <code>power-profiles-daemon</code> is running</p> <pre><code>systemctl status power-profiles-daemon\n</code></pre> <p>2. List available profiles</p> <pre><code>powerprofilesctl list\n</code></pre> <p>3. Install if missing</p> <pre><code># Debian/Ubuntu\nsudo apt install power-profiles-daemon\n\n# Fedora\nsudo dnf install power-profiles-daemon\n</code></pre> <p>If <code>power-profiles-daemon</code> is not installed, the extension falls back to a CLI-based approach. Check the journal for fallback messages.</p>"},{"location":"hardware/troubleshooting/#extension-resets-settings-on-reload","title":"Extension Resets Settings on Reload","text":"<p>Settings are stored in GSettings under <code>org.gnome.shell.extensions.hara-hachi-bu</code>. They persist across extension reloads and GNOME Shell restarts.</p> <p>If settings appear to reset, check:</p> <pre><code>dconf read /org/gnome/shell/extensions/hara-hachi-bu/custom-profiles\n</code></pre> <p>If this returns an empty value, the schema may not be compiled correctly.</p>"},{"location":"hardware/troubleshooting/#force-discharge-doesnt-work","title":"Force Discharge Doesn't Work","text":"<p>Force discharge requires <code>charge_behaviour</code> support in your laptop's kernel driver. This is available on ThinkPad and a few other models.</p> <p>Check:</p> <pre><code>cat /sys/class/power_supply/BAT0/charge_behaviour\n</code></pre> <p>If the file doesn't exist, your hardware doesn't support force discharge. The toggle will not appear in Quick Settings on unsupported hardware.</p>"},{"location":"hardware/troubleshooting/#profiles-not-switching-automatically","title":"Profiles Not Switching Automatically","text":"<p>If auto-switching isn't working as expected:</p> <ol> <li>Check that auto-management is enabled \u2014 Preferences \u2192 General \u2192 Automatic Scenario Switching</li> <li>Check that profiles are marked Auto-managed \u2014 Preferences \u2192 Scenarios \u2192 select the profile \u2192 enable Auto-managed</li> <li>Check that rules are correct \u2014 verify the parameter, operator, and value for each rule</li> <li>Check for conflicts \u2014 two profiles with identical rules at the same specificity will conflict; the extension will warn you in Preferences</li> <li>Check the journal \u2014 the extension logs auto-switch decisions with the matching profile name</li> </ol>"},{"location":"hardware/troubleshooting/#quick-settings-panel-doesnt-appear","title":"Quick Settings Panel Doesn't Appear","text":"<p>If the extension is enabled but the Quick Settings section is missing:</p> <ol> <li>Disable and re-enable the extension:    <pre><code>gnome-extensions disable hara-hachi-bu@ZviBaratz\ngnome-extensions enable hara-hachi-bu@ZviBaratz\n</code></pre></li> <li>Log out and log back in (especially on Wayland \u2014 JS changes require a full session restart)</li> <li>Check the journal for initialization errors</li> </ol>"},{"location":"user-guide/","title":"User Guide","text":"<p>This guide covers all of the extension's features in detail.</p>"},{"location":"user-guide/#topics","title":"Topics","text":""},{"location":"user-guide/#battery-modes","title":"Battery Modes","text":"<p>Understand what Full Capacity, Balanced, and Max Lifespan mean \u2014 including the battery science behind why limiting charge extends lifespan, and the economic and environmental arguments for doing so.</p>"},{"location":"user-guide/#profiles","title":"Profiles","text":"<p>Learn how profiles work: the built-in Docked and Travel scenarios, creating custom profiles, combining power mode with battery mode, and the Boost Charge toggle for one-off full charges.</p>"},{"location":"user-guide/#auto-switch-rules","title":"Auto-Switch Rules","text":"<p>Set up rule-based automatic profile switching. Rules respond to external display connection, power source (AC/battery), lid state, and battery level. Understand how specificity determines which profile wins when multiple rules match.</p>"},{"location":"user-guide/#scheduled-profiles","title":"Scheduled Profiles","text":"<p>Configure time-based profile activation \u2014 select days of the week, set a time range, and let the extension handle switching automatically. Covers overnight schedules (e.g., 23:00\u201307:00), DST handling, and conflict detection.</p>"},{"location":"user-guide/#manual-override","title":"Manual Override","text":"<p>Understand what happens when you manually change settings while auto-switching is active \u2014 how auto-management pauses, what triggers it to resume, and how to resume it yourself.</p>"},{"location":"user-guide/#quick-reference","title":"Quick Reference","text":"I want to\u2026 Go to\u2026 Understand charging thresholds Battery Modes Use Docked/Travel automatically Profiles + Rules Charge to 100% just this once Profiles \u2192 Boost Charge Charge full overnight, then revert Scheduled Profiles Manually override without breaking auto-switch Manual Override"},{"location":"user-guide/battery-modes/","title":"Battery Modes","text":"<p>Hara Hachi Bu controls your laptop's charging threshold \u2014 the maximum percentage the battery charges to. Three modes are provided, each optimised for a different use case.</p>"},{"location":"user-guide/battery-modes/#the-modes","title":"The Modes","text":"Mode Charge Range Optimised For Full Capacity 95\u2013100% Maximum runtime when you need it Balanced 75\u201380% Good runtime with improved longevity Max Lifespan 55\u201360% Maximum battery longevity <p>These ranges are defaults. You can adjust the exact percentages in Preferences \u2192 Thresholds.</p>"},{"location":"user-guide/battery-modes/#why-it-matters","title":"Why It Matters","text":""},{"location":"user-guide/battery-modes/#the-science","title":"The Science","text":"<p>Lithium-ion batteries degrade faster when kept at high charge levels. Limiting the maximum charge \u2014 even slightly \u2014 can dramatically extend battery lifespan.</p> <p>Data from Battery University:</p> Peak Charge Voltage Approx. Capacity Cycle Life 4.20 V (100%) Full 300\u2013500 cycles 4.10 V (~75%) ~85% 600\u20131,000 cycles 4.00 V (~60%) ~75% 850\u20131,500 cycles <p>Every 0.10 V reduction in peak charge voltage roughly doubles cycle life.</p> <p>Depth of discharge matters too: cycling 100% of capacity yields ~300 cycles (NMC chemistry), while cycling only 40% yields ~1,000 cycles.</p> <p>Storage has a similar effect. A battery stored at 40% charge and 25\u00b0C retains 96% capacity after one year. At full charge and the same temperature, only 80% remains. At 40\u00b0C and full charge, capacity drops to 65%.</p>"},{"location":"user-guide/battery-modes/#environmental-impact","title":"Environmental Impact","text":"<p>Battery manufacturing produces 54\u2013115 kg CO\u2082-eq per kWh of capacity, depending on chemistry and sourcing (Nature Communications, 2024). Around 80% of a notebook's total lifetime greenhouse gas emissions come from manufacturing, not use (TCO Certified).</p> <p>Extending a laptop from 3 to 6 years of service roughly halves its annualized carbon footprint.</p> <p>Globally, 62 million tonnes of e-waste were generated in 2022, with less than a quarter (22.3%) properly collected and recycled \u2014 leaving an estimated US $62 billion in recoverable materials unaccounted for (UN Global E-Waste Monitor, 2024).</p>"},{"location":"user-guide/battery-modes/#economic-impact","title":"Economic Impact","text":"<p>Laptop battery replacements cost $50\u2013200 when available, but a degraded battery often prompts full laptop replacement ($300\u2013850+). Charging within the 40\u201380% range can extend usable battery life from ~300\u2013500 cycles (~2 years of daily cycling) to ~1,000\u20131,500+ cycles (~4\u20135 years).</p>"},{"location":"user-guide/battery-modes/#how-to-use-the-modes","title":"How to Use the Modes","text":"<p>Use Max Lifespan when you're working at a desk plugged in \u2014 you don't need more than 60% capacity to get through the day if AC is always available.</p> <p>Use Full Capacity before traveling \u2014 you want maximum runtime when you're away from a power outlet.</p> <p>Use Balanced as a default middle ground that protects the battery without sacrificing too much runtime.</p> <p>Or better yet: let the Docked and Travel profiles handle the switching automatically based on whether an external display is connected or you're on battery. See Profiles and Auto-Switch Rules.</p> <p>For one-off needs (a day trip, a long flight), use Boost Charge to temporarily charge to 100% and have it revert automatically.</p>"},{"location":"user-guide/battery-modes/#hardware-requirements","title":"Hardware Requirements","text":"<p>Battery mode control requires your laptop to expose the standard Linux sysfs interface at <code>/sys/class/power_supply/BAT0/charge_control_end_threshold</code>. Most ThinkPads, Framework laptops, and many ASUS models support this. See Hardware Compatibility for details.</p>"},{"location":"user-guide/manual-override/","title":"Manual Override","text":"<p>When auto-management is enabled, the extension automatically activates the best-matching profile based on your rules. But you can always take manual control.</p>"},{"location":"user-guide/manual-override/#how-it-works","title":"How It Works","text":"<p>If you manually change the power mode, battery mode, or activate a profile while auto-management is active, auto-management pauses. The extension respects your manual choice and does not switch profiles behind your back.</p> <p>The Quick Settings panel shows a Resume button when auto-management is paused.</p>"},{"location":"user-guide/manual-override/#resuming-auto-management","title":"Resuming Auto-Management","text":"<p>Auto-management resumes in two ways:</p> <p>1. Automatic resume on state change</p> <p>When a monitored parameter changes \u2014 an external display is connected or disconnected, the power source switches, or the lid opens or closes \u2014 the extension re-evaluates rules and resumes auto-management if the setting is enabled.</p> <p>This is the default behavior. It means you can temporarily override and then resume automatically just by plugging in or unplugging the laptop.</p> <p>2. Manual resume</p> <p>Click the Resume button in the Quick Settings panel to immediately re-evaluate rules and resume auto-management.</p>"},{"location":"user-guide/manual-override/#configuring-resume-behavior","title":"Configuring Resume Behavior","text":"<p>In Preferences \u2192 General \u2192 Automatic Scenario Switching, you can toggle whether auto-management resumes on state changes. If disabled, you must click Resume manually.</p>"},{"location":"user-guide/manual-override/#boost-charge-and-auto-management","title":"Boost Charge and Auto-Management","text":"<p>The Boost Charge toggle has special handling:</p> <ul> <li>Activating Boost Charge pauses auto-management</li> <li>Deactivating Boost Charge (manually or automatically) resumes auto-management</li> <li>Auto-management then selects the appropriate profile for current conditions \u2014 no need to manually pick one</li> </ul>"},{"location":"user-guide/manual-override/#battery-level-rules","title":"Battery Level Rules","text":"<p>Battery level rules include a \u00b12% hysteresis. If a rule triggers at 20%, the profile won't immediately switch back at 19% \u2014 it waits for a 2% margin. This prevents rapid toggling at the boundary.</p>"},{"location":"user-guide/profiles/","title":"Profiles","text":"<p>A profile (also called a scenario) is a named combination of power mode, battery mode, and optional force discharge setting. Activating a profile applies all settings at once.</p>"},{"location":"user-guide/profiles/#built-in-profiles","title":"Built-in Profiles","text":"<p>Two profiles are included by default:</p> Profile Power Mode Battery Mode Force Discharge Auto-Switch Rule Docked Performance Max Lifespan On External display connected AND on AC power Travel Balanced Full Capacity Off On battery power <p>These are fully customizable. You can edit or delete them in Preferences \u2192 Scenarios. If you delete them, a Restore Default Scenarios button appears to recreate them.</p>"},{"location":"user-guide/profiles/#custom-profiles","title":"Custom Profiles","text":"<p>Create your own profiles in Preferences \u2192 Scenarios. Each profile combines:</p> <ul> <li>Name \u2014 a label shown in Quick Settings and preferences</li> <li>Icon \u2014 one of the standard GNOME symbolic icons</li> <li>Power mode \u2014 Performance, Balanced, or Power Saver</li> <li>Battery mode \u2014 Full Capacity, Balanced, or Max Lifespan</li> <li>Force discharge \u2014 On, Off, or Unspecified (leave unchanged)</li> <li>Auto-switch rules \u2014 optional conditions that activate the profile automatically</li> <li>Schedule \u2014 optional time window for automatic activation</li> </ul>"},{"location":"user-guide/profiles/#creating-a-profile","title":"Creating a Profile","text":"<ol> <li>Open Preferences \u2192 Scenarios</li> <li>Click the + button</li> <li>Set the name, power mode, and battery mode</li> <li>Optionally add rules or a schedule</li> <li>Enable Auto-managed to activate the profile automatically when its rules match</li> </ol>"},{"location":"user-guide/profiles/#exporting-and-importing","title":"Exporting and Importing","text":"<p>Profiles can be exported to a JSON file and imported on another machine. Use the Export and Import buttons at the top of the Scenarios page.</p>"},{"location":"user-guide/profiles/#activating-a-profile","title":"Activating a Profile","text":"<p>Click any profile button in Quick Settings to activate it immediately. This applies the profile's power mode, battery mode, and force discharge settings.</p> <p>Note</p> <p>Manually activating a profile while auto-management is enabled will pause auto-management. The next state change (display connected/disconnected, power source switch, lid open/close) will re-evaluate rules and resume auto-management. See Manual Override.</p>"},{"location":"user-guide/profiles/#boost-charge","title":"Boost Charge","text":"<p>The Boost Charge toggle in Quick Settings provides a one-click way to temporarily charge to 100%.</p> <p>When to use it: you're about to travel and want a full charge, but your normal profile uses Max Lifespan. Instead of manually switching modes (and forgetting to switch back), use Boost Charge \u2014 it reverts automatically.</p>"},{"location":"user-guide/profiles/#how-it-works","title":"How It Works","text":"<ol> <li>Toggle Boost Charge in Quick Settings (AC power required)</li> <li>The extension sets thresholds to 95\u2013100% (or 0\u2013100% on end-only devices)</li> <li>Auto-management is paused</li> <li>Charging proceeds normally to 100%</li> </ol>"},{"location":"user-guide/profiles/#automatic-revert","title":"Automatic Revert","text":"<p>Boost Charge deactivates automatically when any of these occur:</p> <ul> <li>Battery reaches 100%</li> <li>Safety timeout expires (default: 2 hours, configurable in Preferences \u2192 General)</li> <li>AC power is disconnected</li> <li>You manually change the battery mode</li> </ul> <p>On deactivation, auto-management resumes and selects the appropriate profile for current conditions.</p> <p>Tip</p> <p>The primary stop trigger is the battery reaching 100%. The safety timeout is a fallback in case something prevents the battery-full signal from arriving.</p>"},{"location":"user-guide/rules/","title":"Auto-Switch Rules","text":"<p>Rules let profiles activate automatically based on system state. When conditions match, the extension applies the profile without any manual action.</p>"},{"location":"user-guide/rules/#parameters","title":"Parameters","text":"<p>Each rule checks one system parameter:</p> Parameter Description Values <code>external_display</code> Whether an external monitor is connected <code>connected</code> / <code>not_connected</code> <code>power_source</code> Whether the laptop is on AC or battery <code>ac</code> / <code>battery</code> <code>lid</code> Whether the lid is open or closed <code>open</code> / <code>closed</code> <code>battery_level</code> Current battery percentage Number (0\u2013100)"},{"location":"user-guide/rules/#operators","title":"Operators","text":"Operator Description Example <code>is</code> Exact match <code>power_source is ac</code> <code>is_not</code> Negation <code>power_source is_not battery</code> <code>above</code> Greater than (battery level) <code>battery_level above 20</code> <code>below</code> Less than (battery level) <code>battery_level below 20</code> <p>Battery level rules include a \u00b12% hysteresis to prevent rapid switching at the threshold boundary.</p>"},{"location":"user-guide/rules/#how-rules-work","title":"How Rules Work","text":"<p>A profile activates when all of its rules match simultaneously. A profile with no rules never activates automatically (it must be activated manually).</p>"},{"location":"user-guide/rules/#specificity","title":"Specificity","text":"<p>When multiple profiles have matching rules, the one with the most conditions wins \u2014 this is called most-specific-wins.</p> <p>Examples:</p> Profile Rules Specificity Docked external_display is connected AND power_source is ac 2 Travel power_source is battery 1 Quiet Work (no rules) 0 <p>If an external display is connected and you're on AC, Docked (specificity 2) wins over Travel (specificity 1), even though Travel's rule also matches.</p> <p>Scheduled profiles gain +1 specificity when their schedule is currently active. See Scheduled Profiles for details.</p>"},{"location":"user-guide/rules/#conflict-detection","title":"Conflict Detection","text":"<p>The extension prevents conflicting configurations at save time:</p> <ul> <li>Same rules, both unscheduled \u2192 conflict (differentiate with an extra rule or add a schedule)</li> <li>Same rules, one scheduled / one not \u2192 no conflict (scheduled profile wins during its window)</li> <li>Same rules, both scheduled, non-overlapping times \u2192 no conflict</li> <li>Same rules, both scheduled, overlapping times \u2192 conflict</li> </ul> <p>When a conflict is detected, the Preferences UI shows an error and blocks saving until it's resolved.</p>"},{"location":"user-guide/rules/#setting-up-rules","title":"Setting Up Rules","text":"<ol> <li>Open Preferences \u2192 Scenarios</li> <li>Select a profile (or create one)</li> <li>In the Rules section, click + to add a condition</li> <li>Choose a parameter, operator, and value</li> <li>Repeat for additional conditions (all must match)</li> <li>Enable Auto-managed to activate automatic switching</li> </ol>"},{"location":"user-guide/rules/#example-docked-profile","title":"Example: Docked Profile","text":"<p>The built-in Docked profile uses two rules:</p> <pre><code>external_display is connected\npower_source is ac\n</code></pre> <p>Both must be true. If the external display is connected but you're on battery, the Docked profile does not activate \u2014 the Travel profile (with <code>power_source is battery</code>) activates instead.</p>"},{"location":"user-guide/rules/#example-low-battery-alert-profile","title":"Example: Low Battery Alert Profile","text":"<p>Create a profile named \"Low Battery\" with Power Saver mode and these rules:</p> <pre><code>battery_level below 20\npower_source is battery\n</code></pre> <p>The extension switches to Power Saver automatically when the battery drops below 20% on battery power.</p>"},{"location":"user-guide/schedules/","title":"Scheduled Profiles","text":"<p>A schedule adds a time window to a profile. When the current time falls within the window, the schedule counts as active \u2014 contributing to whether the profile activates automatically.</p>"},{"location":"user-guide/schedules/#setting-up-a-schedule","title":"Setting Up a Schedule","text":"<p>In Preferences \u2192 Scenarios, select a profile and enable the Schedule toggle. Configure:</p> <ul> <li>Days \u2014 select individual days (Mon\u2013Sun) or use quick-select buttons: Weekdays, Weekends, All</li> <li>Start time \u2014 when the schedule window opens (24-hour format)</li> <li>End time \u2014 when the schedule window closes (24-hour format)</li> </ul>"},{"location":"user-guide/schedules/#overnight-schedules","title":"Overnight Schedules","text":"<p>Setting start time after end time creates an overnight window. For example, <code>23:00\u201307:00</code> means:</p> <ul> <li>From 23:00 to midnight: check today's day selection</li> <li>From midnight to 07:00: check yesterday's day selection</li> </ul> <p>This lets you create a \"charge overnight\" schedule that spans the day boundary correctly: a Monday\u2013Friday <code>23:00\u201307:00</code> schedule activates on Monday night (23:00) through Tuesday morning (07:00), on Tuesday night through Wednesday morning, and so on.</p>"},{"location":"user-guide/schedules/#specificity","title":"Specificity and Rules","text":"<p>A schedule adds +1 to profile specificity when it is currently active. This means:</p> Profile Rules Schedule Active Effective Specificity Docked 2 rules No 2 Morning Charge 1 rule Yes 2 Overnight No rules Yes 1 <p>A schedule-only profile (no rules) reaches specificity 1 when active \u2014 enough to match if no rule-based profile is competing.</p>"},{"location":"user-guide/schedules/#conflict-detection","title":"Conflict Detection","text":"<p>The extension checks for conflicts when you save a profile's schedule:</p> Situation Outcome Same rules, one scheduled / one not No conflict \u2014 scheduled profile wins during its window Same rules, both scheduled, non-overlapping times No conflict Same rules, both scheduled, overlapping times Conflict \u2014 adjust time ranges to fix Same rules, both unscheduled Conflict \u2014 add a schedule or extra rule"},{"location":"user-guide/schedules/#example-morning-charge","title":"Example: Morning Charge","text":"<p>Charge to Full Capacity on weekday mornings and revert automatically.</p> <ol> <li>Create a profile named Morning Charge</li> <li>Set battery mode to Full Capacity, power mode to Balanced</li> <li>Enable Auto-managed</li> <li>Enable Schedule: Weekdays, 05:30\u201308:00</li> </ol> <p>The extension activates the profile at 05:30 on weekdays and deactivates it at 08:00, reverting to whichever profile is appropriate for the current conditions (e.g., Docked or Travel based on rules).</p>"},{"location":"user-guide/schedules/#dst-and-clock-drift","title":"DST and Clock Drift","text":"<p>During daylight saving time transitions, a schedule boundary may fire up to one hour late. The extension self-corrects within the hour \u2014 no manual action needed.</p> <p>The schedule timer is capped at one hour internally to guard against both DST shifts and clock drift.</p>"},{"location":"user-guide/schedules/#suspend-and-resume","title":"Suspend and Resume","text":"<p>When the system suspends and resumes (sleep/wake), the extension re-evaluates all schedule timers immediately. A schedule that became active or inactive during sleep is applied correctly on wake.</p>"}]}